<UserControl x:Class="HospitexDPP.Views.BrandProductsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:controls="clr-namespace:HospitexDPP.Controls">
    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis" />
    </UserControl.Resources>

    <Grid>
        <!-- Main content -->
        <DockPanel Margin="24,20">
            <!-- Toolbar -->
            <DockPanel DockPanel.Dock="Top" Margin="0,0,0,16">
                <Button Content="{DynamicResource Button_Add}"
                        Style="{DynamicResource PrimaryButton}"
                        DockPanel.Dock="Right"
                        Command="{Binding AddCommand}" />
                <TextBox Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                         Style="{DynamicResource SearchTextBox}"
                         Tag="{DynamicResource Search_Products}"
                         Margin="0,0,12,0" />
                <ItemsControl Style="{DynamicResource FilterToggleBar}"
                              ItemsSource="{Binding StatusFilterOptions}"
                              HorizontalAlignment="Left" />
            </DockPanel>

            <!-- Empty state -->
            <controls:EmptyState Title="{DynamicResource Empty_NoProducts}"
                                 Description="{DynamicResource Empty_NoProductsDesc}"
                                 ActionText="{DynamicResource Button_Add}"
                                 ActionCommand="{Binding AddCommand}">
                <controls:EmptyState.Style>
                    <Style TargetType="controls:EmptyState">
                        <Setter Property="Visibility" Value="Collapsed" />
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding HasProducts}" Value="False">
                                <Setter Property="Visibility" Value="Visible" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </controls:EmptyState.Style>
            </controls:EmptyState>

            <!-- DataGrid -->
            <DataGrid ItemsSource="{Binding Products}"
                      SelectedItem="{Binding SelectedProduct}"
                      Style="{DynamicResource AdminDataGrid}"
                      Visibility="{Binding HasProducts, Converter={StaticResource BoolToVis}}"
                      MouseDoubleClick="DataGrid_MouseDoubleClick">
                <DataGrid.Columns>
                    <!-- Name + Article number -->
                    <DataGridTemplateColumn Width="2*">
                        <DataGridTemplateColumn.Header>
                            <TextBlock Text="{DynamicResource Column_Name}" />
                        </DataGridTemplateColumn.Header>
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel VerticalAlignment="Center" Margin="12,0">
                                    <TextBlock Text="{Binding ProductName}" FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimaryBrush}" FontSize="13" />
                                    <TextBlock Text="{Binding ArticleNumber}"
                                               Foreground="{DynamicResource TextSecondaryBrush}" FontSize="11">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Visibility" Value="Visible" />
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding ArticleNumber}" Value="{x:Null}">
                                                        <Setter Property="Visibility" Value="Collapsed" />
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding ArticleNumber}" Value="">
                                                        <Setter Property="Visibility" Value="Collapsed" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!-- Category -->
                    <DataGridTemplateColumn Width="*">
                        <DataGridTemplateColumn.Header>
                            <TextBlock Text="{DynamicResource Column_Category}" />
                        </DataGridTemplateColumn.Header>
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Category}" VerticalAlignment="Center"
                                           Margin="12,0" Foreground="{DynamicResource TextPrimaryBrush}" FontSize="13" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!-- Status -->
                    <DataGridTemplateColumn Width="*">
                        <DataGridTemplateColumn.Header>
                            <TextBlock Text="{DynamicResource Column_Status}" />
                        </DataGridTemplateColumn.Header>
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <controls:StatusBadge IsActive="{Binding IsActive}" Margin="12,0" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!-- Variants -->
                    <DataGridTemplateColumn Width="*">
                        <DataGridTemplateColumn.HeaderStyle>
                            <Style TargetType="DataGridColumnHeader" BasedOn="{StaticResource {x:Type DataGridColumnHeader}}">
                                <Setter Property="HorizontalContentAlignment" Value="Right" />
                            </Style>
                        </DataGridTemplateColumn.HeaderStyle>
                        <DataGridTemplateColumn.Header>
                            <TextBlock Text="{DynamicResource Column_Variants}" />
                        </DataGridTemplateColumn.Header>
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding VariantCount}" VerticalAlignment="Center"
                                           HorizontalAlignment="Right" Margin="0,0,12,0"
                                           Foreground="{DynamicResource TextPrimaryBrush}" FontSize="13" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!-- Updated -->
                    <DataGridTemplateColumn Width="*">
                        <DataGridTemplateColumn.Header>
                            <TextBlock Text="{DynamicResource Column_Updated}" />
                        </DataGridTemplateColumn.Header>
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding UpdatedAt}" VerticalAlignment="Center"
                                           Margin="12,0" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="12" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!-- Action menu -->
                    <DataGridTemplateColumn Width="Auto">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Button Style="{DynamicResource ActionMenuButton}"
                                        Click="ActionMenu_Click" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </DockPanel>

        <!-- Drawer overlay (600px wide for product detail) -->
        <controls:DrawerPanel IsOpen="{Binding IsDrawerOpen}"
                              CloseCommand="{Binding CancelDrawerCommand}"
                              DrawerWidth="600">
            <controls:DrawerPanel.DrawerContent>
                <DockPanel>
                    <!-- Fixed header -->
                    <TextBlock Text="{Binding DrawerTitle}" Style="{DynamicResource DrawerTitle}"
                               DockPanel.Dock="Top" Margin="24,20,24,0" />

                    <!-- Fixed footer (for product info save) -->
                    <StackPanel DockPanel.Dock="Bottom" Margin="24,0,24,20">
                        <TextBlock Text="{Binding StatusMessage}" Foreground="{DynamicResource DangerBrush}"
                                   FontSize="12" Margin="0,0,0,8" TextWrapping="Wrap" />
                        <StackPanel Orientation="Horizontal">
                            <Button Content="{DynamicResource Button_Save}"
                                    Style="{DynamicResource PrimaryButton}"
                                    Command="{Binding SaveCommand}" Margin="0,0,8,0" />
                            <Button Content="{DynamicResource Button_Cancel}"
                                    Style="{DynamicResource SecondaryButton}"
                                    Command="{Binding CancelDrawerCommand}" />
                        </StackPanel>
                    </StackPanel>

                    <!-- Scrollable sections -->
                    <ScrollViewer VerticalScrollBarVisibility="Auto" Margin="24,12,24,12" Padding="0,0,12,0">
                        <StackPanel>
                            <!-- SECTION 1: Product Info -->
                            <Expander IsExpanded="True" Style="{DynamicResource SectionExpander}">
                                <Expander.Header>
                                    <TextBlock Text="{DynamicResource Section_ProductInfo}"
                                               Style="{DynamicResource SectionHeader}" />
                                </Expander.Header>
                                <Grid Margin="0,8,0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" MinWidth="140" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>

                                    <!-- Row 0: Product Name -->
                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="{DynamicResource Field_ProductName}"
                                               Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                               VerticalAlignment="Center" Margin="0,0,12,8" />
                                    <TextBox Grid.Row="0" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                             Text="{Binding EditProductName, UpdateSourceTrigger=PropertyChanged}" />

                                    <!-- Row 1: GTIN Type -->
                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="{DynamicResource Field_GtinType}"
                                               Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                               VerticalAlignment="Center" Margin="0,0,12,8" />
                                    <TextBox Grid.Row="1" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                             Text="{Binding EditGtinType, UpdateSourceTrigger=PropertyChanged}" />

                                    <!-- Row 2: GTIN -->
                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="{DynamicResource Field_Gtin}"
                                               Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                               VerticalAlignment="Center" Margin="0,0,12,8" />
                                    <TextBox Grid.Row="2" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                             Text="{Binding EditGtin, UpdateSourceTrigger=PropertyChanged}" />

                                    <!-- Row 3: Description -->
                                    <TextBlock Grid.Row="3" Grid.Column="0" Text="{DynamicResource Field_Description}"
                                               Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                               VerticalAlignment="Top" Margin="0,0,12,8" />
                                    <TextBox Grid.Row="3" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                             Text="{Binding EditDescription, UpdateSourceTrigger=PropertyChanged}"
                                             TextWrapping="Wrap" AcceptsReturn="True" MinHeight="60" />

                                    <!-- Row 4: Photo URL -->
                                    <TextBlock Grid.Row="4" Grid.Column="0" Text="{DynamicResource Field_PhotoUrl}"
                                               Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                               VerticalAlignment="Center" Margin="0,0,12,8" />
                                    <TextBox Grid.Row="4" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                             Text="{Binding EditPhotoUrl, UpdateSourceTrigger=PropertyChanged}" />

                                    <!-- Row 5: Article Number -->
                                    <TextBlock Grid.Row="5" Grid.Column="0" Text="{DynamicResource Field_ArticleNumber}"
                                               Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                               VerticalAlignment="Center" Margin="0,0,12,8" />
                                    <TextBox Grid.Row="5" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                             Text="{Binding EditArticleNumber, UpdateSourceTrigger=PropertyChanged}" />

                                    <!-- Row 6: Commodity Code System -->
                                    <TextBlock Grid.Row="6" Grid.Column="0" Text="{DynamicResource Field_CommodityCodeSystem}"
                                               Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                               VerticalAlignment="Center" Margin="0,0,12,8" />
                                    <TextBox Grid.Row="6" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                             Text="{Binding EditCommodityCodeSystem, UpdateSourceTrigger=PropertyChanged}" />

                                    <!-- Row 7: Commodity Code Number -->
                                    <TextBlock Grid.Row="7" Grid.Column="0" Text="{DynamicResource Field_CommodityCodeNumber}"
                                               Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                               VerticalAlignment="Center" Margin="0,0,12,8" />
                                    <TextBox Grid.Row="7" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                             Text="{Binding EditCommodityCodeNumber, UpdateSourceTrigger=PropertyChanged}" />

                                    <!-- Row 8: Year of Sale -->
                                    <TextBlock Grid.Row="8" Grid.Column="0" Text="{DynamicResource Field_YearOfSale}"
                                               Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                               VerticalAlignment="Center" Margin="0,0,12,8" />
                                    <TextBox Grid.Row="8" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                             Text="{Binding EditYearOfSale, UpdateSourceTrigger=PropertyChanged}" />

                                    <!-- Row 9: Season of Sale -->
                                    <TextBlock Grid.Row="9" Grid.Column="0" Text="{DynamicResource Field_SeasonOfSale}"
                                               Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                               VerticalAlignment="Center" Margin="0,0,12,8" />
                                    <TextBox Grid.Row="9" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                             Text="{Binding EditSeasonOfSale, UpdateSourceTrigger=PropertyChanged}" />

                                    <!-- Row 10: Price Currency -->
                                    <TextBlock Grid.Row="10" Grid.Column="0" Text="{DynamicResource Field_PriceCurrency}"
                                               Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                               VerticalAlignment="Center" Margin="0,0,12,8" />
                                    <TextBox Grid.Row="10" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                             Text="{Binding EditPriceCurrency, UpdateSourceTrigger=PropertyChanged}" />

                                    <!-- Row 11: MSRP -->
                                    <TextBlock Grid.Row="11" Grid.Column="0" Text="{DynamicResource Field_Msrp}"
                                               Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                               VerticalAlignment="Center" Margin="0,0,12,8" />
                                    <TextBox Grid.Row="11" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                             Text="{Binding EditMsrp, UpdateSourceTrigger=PropertyChanged}" />

                                    <!-- Row 12: Resale Price -->
                                    <TextBlock Grid.Row="12" Grid.Column="0" Text="{DynamicResource Field_ResalePrice}"
                                               Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                               VerticalAlignment="Center" Margin="0,0,12,8" />
                                    <TextBox Grid.Row="12" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                             Text="{Binding EditResalePrice, UpdateSourceTrigger=PropertyChanged}" />

                                    <!-- Row 13: Category -->
                                    <TextBlock Grid.Row="13" Grid.Column="0" Text="{DynamicResource Field_Category}"
                                               Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                               VerticalAlignment="Center" Margin="0,0,12,8" />
                                    <TextBox Grid.Row="13" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                             Text="{Binding EditCategory, UpdateSourceTrigger=PropertyChanged}" />

                                    <!-- Row 14: Product Group -->
                                    <TextBlock Grid.Row="14" Grid.Column="0" Text="{DynamicResource Field_ProductGroup}"
                                               Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                               VerticalAlignment="Center" Margin="0,0,12,8" />
                                    <TextBox Grid.Row="14" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                             Text="{Binding EditProductGroup, UpdateSourceTrigger=PropertyChanged}" />

                                    <!-- Row 15: Type/Line/Concept -->
                                    <TextBlock Grid.Row="15" Grid.Column="0" Text="{DynamicResource Field_TypeLineConcept}"
                                               Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                               VerticalAlignment="Center" Margin="0,0,12,8" />
                                    <TextBox Grid.Row="15" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                             Text="{Binding EditTypeLineConcept, UpdateSourceTrigger=PropertyChanged}" />

                                    <!-- Row 16: Type Item -->
                                    <TextBlock Grid.Row="16" Grid.Column="0" Text="{DynamicResource Field_TypeItem}"
                                               Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                               VerticalAlignment="Center" Margin="0,0,12,8" />
                                    <TextBox Grid.Row="16" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                             Text="{Binding EditTypeItem, UpdateSourceTrigger=PropertyChanged}" />

                                    <!-- Row 17: Age Group -->
                                    <TextBlock Grid.Row="17" Grid.Column="0" Text="{DynamicResource Field_AgeGroup}"
                                               Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                               VerticalAlignment="Center" Margin="0,0,12,8" />
                                    <TextBox Grid.Row="17" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                             Text="{Binding EditAgeGroup, UpdateSourceTrigger=PropertyChanged}" />

                                    <!-- Row 18: Gender -->
                                    <TextBlock Grid.Row="18" Grid.Column="0" Text="{DynamicResource Field_Gender}"
                                               Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                               VerticalAlignment="Center" Margin="0,0,12,8" />
                                    <TextBox Grid.Row="18" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                             Text="{Binding EditGender, UpdateSourceTrigger=PropertyChanged}" />

                                    <!-- Row 19: Market Segment -->
                                    <TextBlock Grid.Row="19" Grid.Column="0" Text="{DynamicResource Field_MarketSegment}"
                                               Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                               VerticalAlignment="Center" Margin="0,0,12,8" />
                                    <TextBox Grid.Row="19" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                             Text="{Binding EditMarketSegment, UpdateSourceTrigger=PropertyChanged}" />

                                    <!-- Row 20: Water Properties -->
                                    <TextBlock Grid.Row="20" Grid.Column="0" Text="{DynamicResource Field_WaterProperties}"
                                               Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                               VerticalAlignment="Center" Margin="0,0,12,8" />
                                    <TextBox Grid.Row="20" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                             Text="{Binding EditWaterProperties, UpdateSourceTrigger=PropertyChanged}" />

                                    <!-- Row 21: Net Weight -->
                                    <TextBlock Grid.Row="21" Grid.Column="0" Text="{DynamicResource Field_NetWeight}"
                                               Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                               VerticalAlignment="Center" Margin="0,0,12,8" />
                                    <TextBox Grid.Row="21" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                             Text="{Binding EditNetWeight, UpdateSourceTrigger=PropertyChanged}" />

                                    <!-- Row 22: Weight Unit -->
                                    <TextBlock Grid.Row="22" Grid.Column="0" Text="{DynamicResource Field_WeightUnit}"
                                               Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                               VerticalAlignment="Center" Margin="0,0,12,8" />
                                    <TextBox Grid.Row="22" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                             Text="{Binding EditWeightUnit, UpdateSourceTrigger=PropertyChanged}" />

                                    <!-- Row 23: Data Carrier Type -->
                                    <TextBlock Grid.Row="23" Grid.Column="0" Text="{DynamicResource Field_DataCarrierType}"
                                               Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                               VerticalAlignment="Center" Margin="0,0,12,8" />
                                    <TextBox Grid.Row="23" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                             Text="{Binding EditDataCarrierType, UpdateSourceTrigger=PropertyChanged}" />

                                    <!-- Row 24: Data Carrier Material -->
                                    <TextBlock Grid.Row="24" Grid.Column="0" Text="{DynamicResource Field_DataCarrierMaterial}"
                                               Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                               VerticalAlignment="Center" Margin="0,0,12,8" />
                                    <TextBox Grid.Row="24" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                             Text="{Binding EditDataCarrierMaterial, UpdateSourceTrigger=PropertyChanged}" />

                                    <!-- Row 25: Data Carrier Location -->
                                    <TextBlock Grid.Row="25" Grid.Column="0" Text="{DynamicResource Field_DataCarrierLocation}"
                                               Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                               VerticalAlignment="Center" Margin="0,0,12,8" />
                                    <TextBox Grid.Row="25" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                             Text="{Binding EditDataCarrierLocation, UpdateSourceTrigger=PropertyChanged}" />

                                    <!-- Row 26: IsActive checkbox (only in edit mode) -->
                                    <CheckBox Grid.Row="26" Grid.Column="1"
                                              Content="{DynamicResource Status_Active}"
                                              IsChecked="{Binding EditIsActive}"
                                              Visibility="{Binding ShowIsActive, Converter={StaticResource BoolToVis}}"
                                              Margin="0,4,0,0" />
                                </Grid>
                            </Expander>

                            <!-- SECTION 2: Variants (only in edit mode) -->
                            <Expander Style="{DynamicResource SectionExpander}"
                                      Visibility="{Binding IsEditMode, Converter={StaticResource BoolToVis}}">
                                <Expander.Header>
                                    <TextBlock Text="{DynamicResource Section_Variants}"
                                               Style="{DynamicResource SectionHeader}" />
                                </Expander.Header>
                                <StackPanel Margin="0,8,0,8">
                                    <DataGrid ItemsSource="{Binding Variants}"
                                              Style="{DynamicResource InlineDataGrid}"
                                              Margin="0,0,0,8">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Artnr" Binding="{Binding ItemNumber}" Width="*" />
                                            <DataGridTextColumn Header="Storlek" Binding="{Binding Size}" Width="80" />
                                            <DataGridTextColumn Header="Färg (brand)" Binding="{Binding ColorBrand}" Width="*" />
                                            <DataGridTextColumn Header="Färg" Binding="{Binding ColorGeneral}" Width="80" />
                                            <DataGridTextColumn Header="GTIN" Binding="{Binding Gtin}" Width="*" />
                                            <DataGridTemplateColumn Width="Auto">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <Button Content="✕" FontSize="11" Padding="4,2"
                                                                Style="{DynamicResource SecondaryButton}"
                                                                Command="{Binding DataContext.DeleteVariantCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                                CommandParameter="{Binding}" />
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                    <Button Content="{DynamicResource Button_AddVariant}"
                                            Style="{DynamicResource SecondaryButton}"
                                            Command="{Binding AddVariantCommand}"
                                            HorizontalAlignment="Left" />
                                </StackPanel>
                            </Expander>

                            <!-- SECTION 3: Components (only in edit mode) -->
                            <Expander Style="{DynamicResource SectionExpander}"
                                      Visibility="{Binding IsEditMode, Converter={StaticResource BoolToVis}}">
                                <Expander.Header>
                                    <TextBlock Text="{DynamicResource Section_Components}"
                                               Style="{DynamicResource SectionHeader}" />
                                </Expander.Header>
                                <StackPanel Margin="0,8,0,8">
                                    <DataGrid ItemsSource="{Binding Components}"
                                              Style="{DynamicResource InlineDataGrid}"
                                              Margin="0,0,0,8">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Komponent" Binding="{Binding Component}" Width="*" />
                                            <DataGridTextColumn Header="Material" Binding="{Binding Material}" Width="*" />
                                            <DataGridTextColumn Header="Innehåll" Binding="{Binding ContentName}" Width="*" />
                                            <DataGridTextColumn Header="%" Binding="{Binding ContentValue}" Width="50">
                                                <DataGridTextColumn.HeaderStyle>
                                                    <Style TargetType="DataGridColumnHeader" BasedOn="{StaticResource {x:Type DataGridColumnHeader}}">
                                                        <Setter Property="HorizontalContentAlignment" Value="Right" />
                                                    </Style>
                                                </DataGridTextColumn.HeaderStyle>
                                                <DataGridTextColumn.ElementStyle>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="HorizontalAlignment" Value="Right" />
                                                        <Setter Property="Margin" Value="0,0,12,0" />
                                                    </Style>
                                                </DataGridTextColumn.ElementStyle>
                                            </DataGridTextColumn>
                                            <DataGridTextColumn Header="Källa" Binding="{Binding ContentSource}" Width="80" />
                                            <DataGridTemplateColumn Width="Auto">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <Button Content="✕" FontSize="11" Padding="4,2"
                                                                Style="{DynamicResource SecondaryButton}"
                                                                Command="{Binding DataContext.DeleteComponentCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                                CommandParameter="{Binding}" />
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                    <Button Content="{DynamicResource Button_AddComponent}"
                                            Style="{DynamicResource SecondaryButton}"
                                            Command="{Binding AddComponentCommand}"
                                            HorizontalAlignment="Left" />
                                </StackPanel>
                            </Expander>

                            <!-- SECTION 4: Care (only in edit mode) -->
                            <Expander Style="{DynamicResource SectionExpander}"
                                      Visibility="{Binding IsEditMode, Converter={StaticResource BoolToVis}}">
                                <Expander.Header>
                                    <TextBlock Text="{DynamicResource Section_Care}"
                                               Style="{DynamicResource SectionHeader}" />
                                </Expander.Header>
                                <StackPanel Margin="0,8,0,8">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" MinWidth="140" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                        </Grid.RowDefinitions>

                                        <TextBlock Grid.Row="0" Grid.Column="0" Text="{DynamicResource Field_CareImageUrl}"
                                                   Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                                   VerticalAlignment="Center" Margin="0,0,12,8" />
                                        <TextBox Grid.Row="0" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                                 Text="{Binding EditCareImageUrl, UpdateSourceTrigger=PropertyChanged}" />

                                        <TextBlock Grid.Row="1" Grid.Column="0" Text="{DynamicResource Field_CareText}"
                                                   Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                                   VerticalAlignment="Top" Margin="0,0,12,8" />
                                        <TextBox Grid.Row="1" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                                 Text="{Binding EditCareText, UpdateSourceTrigger=PropertyChanged}"
                                                 TextWrapping="Wrap" AcceptsReturn="True" MinHeight="60" />

                                        <TextBlock Grid.Row="2" Grid.Column="0" Text="{DynamicResource Field_SafetyInfo}"
                                                   Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                                   VerticalAlignment="Top" Margin="0,0,12,8" />
                                        <TextBox Grid.Row="2" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                                 Text="{Binding EditSafetyInfo, UpdateSourceTrigger=PropertyChanged}"
                                                 TextWrapping="Wrap" AcceptsReturn="True" MinHeight="60" />
                                    </Grid>
                                    <Button Content="{DynamicResource Button_SaveCare}"
                                            Style="{DynamicResource PrimaryButton}"
                                            Command="{Binding SaveCareCommand}"
                                            HorizontalAlignment="Left" Margin="0,8,0,0" />
                                </StackPanel>
                            </Expander>

                            <!-- SECTION 5: Compliance (only in edit mode) -->
                            <Expander Style="{DynamicResource SectionExpander}"
                                      Visibility="{Binding IsEditMode, Converter={StaticResource BoolToVis}}">
                                <Expander.Header>
                                    <TextBlock Text="{DynamicResource Section_Compliance}"
                                               Style="{DynamicResource SectionHeader}" />
                                </Expander.Header>
                                <StackPanel Margin="0,8,0,8">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" MinWidth="140" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                        </Grid.RowDefinitions>

                                        <TextBlock Grid.Row="0" Grid.Column="0" Text="{DynamicResource Field_HarmfulSubstances}"
                                                   Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                                   VerticalAlignment="Center" Margin="0,0,12,8" />
                                        <TextBox Grid.Row="0" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                                 Text="{Binding EditHarmfulSubstances, UpdateSourceTrigger=PropertyChanged}" />

                                        <TextBlock Grid.Row="1" Grid.Column="0" Text="{DynamicResource Field_HarmfulSubstancesInfo}"
                                                   Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                                   VerticalAlignment="Center" Margin="0,0,12,8" />
                                        <TextBox Grid.Row="1" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                                 Text="{Binding EditHarmfulSubstancesInfo, UpdateSourceTrigger=PropertyChanged}" />

                                        <TextBlock Grid.Row="2" Grid.Column="0" Text="{DynamicResource Field_Certifications}"
                                                   Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                                   VerticalAlignment="Center" Margin="0,0,12,8" />
                                        <TextBox Grid.Row="2" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                                 Text="{Binding EditCertifications, UpdateSourceTrigger=PropertyChanged}" />

                                        <TextBlock Grid.Row="3" Grid.Column="0" Text="{DynamicResource Field_CertificationsValidation}"
                                                   Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                                   VerticalAlignment="Center" Margin="0,0,12,8" />
                                        <TextBox Grid.Row="3" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                                 Text="{Binding EditCertificationsValidation, UpdateSourceTrigger=PropertyChanged}" />

                                        <TextBlock Grid.Row="4" Grid.Column="0" Text="{DynamicResource Field_ChemicalComplianceStandard}"
                                                   Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                                   VerticalAlignment="Center" Margin="0,0,12,8" />
                                        <TextBox Grid.Row="4" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                                 Text="{Binding EditChemicalComplianceStandard, UpdateSourceTrigger=PropertyChanged}" />

                                        <TextBlock Grid.Row="5" Grid.Column="0" Text="{DynamicResource Field_ChemicalComplianceValidation}"
                                                   Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                                   VerticalAlignment="Center" Margin="0,0,12,8" />
                                        <TextBox Grid.Row="5" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                                 Text="{Binding EditChemicalComplianceValidation, UpdateSourceTrigger=PropertyChanged}" />

                                        <TextBlock Grid.Row="6" Grid.Column="0" Text="{DynamicResource Field_ChemicalComplianceLink}"
                                                   Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                                   VerticalAlignment="Center" Margin="0,0,12,8" />
                                        <TextBox Grid.Row="6" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                                 Text="{Binding EditChemicalComplianceLink, UpdateSourceTrigger=PropertyChanged}" />

                                        <TextBlock Grid.Row="7" Grid.Column="0" Text="{DynamicResource Field_Microfibers}"
                                                   Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                                   VerticalAlignment="Center" Margin="0,0,12,8" />
                                        <TextBox Grid.Row="7" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                                 Text="{Binding EditMicrofibers, UpdateSourceTrigger=PropertyChanged}" />

                                        <TextBlock Grid.Row="8" Grid.Column="0" Text="{DynamicResource Field_TraceabilityProvider}"
                                                   Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                                   VerticalAlignment="Center" Margin="0,0,12,8" />
                                        <TextBox Grid.Row="8" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                                 Text="{Binding EditTraceabilityProvider, UpdateSourceTrigger=PropertyChanged}" />
                                    </Grid>
                                    <Button Content="{DynamicResource Button_SaveCompliance}"
                                            Style="{DynamicResource PrimaryButton}"
                                            Command="{Binding SaveComplianceCommand}"
                                            HorizontalAlignment="Left" Margin="0,8,0,0" />
                                </StackPanel>
                            </Expander>

                            <!-- SECTION 6: Circularity (only in edit mode) -->
                            <Expander Style="{DynamicResource SectionExpander}"
                                      Visibility="{Binding IsEditMode, Converter={StaticResource BoolToVis}}">
                                <Expander.Header>
                                    <TextBlock Text="{DynamicResource Section_Circularity}"
                                               Style="{DynamicResource SectionHeader}" />
                                </Expander.Header>
                                <StackPanel Margin="0,8,0,8">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" MinWidth="140" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                        </Grid.RowDefinitions>

                                        <TextBlock Grid.Row="0" Grid.Column="0" Text="{DynamicResource Field_Performance}"
                                                   Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                                   VerticalAlignment="Center" Margin="0,0,12,8" />
                                        <TextBox Grid.Row="0" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                                 Text="{Binding EditPerformance, UpdateSourceTrigger=PropertyChanged}" />

                                        <TextBlock Grid.Row="1" Grid.Column="0" Text="{DynamicResource Field_Recyclability}"
                                                   Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                                   VerticalAlignment="Center" Margin="0,0,12,8" />
                                        <TextBox Grid.Row="1" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                                 Text="{Binding EditRecyclability, UpdateSourceTrigger=PropertyChanged}" />

                                        <TextBlock Grid.Row="2" Grid.Column="0" Text="{DynamicResource Field_TakeBackInstructions}"
                                                   Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                                   VerticalAlignment="Top" Margin="0,0,12,8" />
                                        <TextBox Grid.Row="2" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                                 Text="{Binding EditTakeBackInstructions, UpdateSourceTrigger=PropertyChanged}"
                                                 TextWrapping="Wrap" AcceptsReturn="True" MinHeight="48" />

                                        <TextBlock Grid.Row="3" Grid.Column="0" Text="{DynamicResource Field_RecyclingInstructions}"
                                                   Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                                   VerticalAlignment="Top" Margin="0,0,12,8" />
                                        <TextBox Grid.Row="3" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                                 Text="{Binding EditRecyclingInstructions, UpdateSourceTrigger=PropertyChanged}"
                                                 TextWrapping="Wrap" AcceptsReturn="True" MinHeight="48" />

                                        <TextBlock Grid.Row="4" Grid.Column="0" Text="{DynamicResource Field_DisassemblyInstructionsSorters}"
                                                   Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                                   VerticalAlignment="Top" Margin="0,0,12,8" />
                                        <TextBox Grid.Row="4" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                                 Text="{Binding EditDisassemblyInstructionsSorters, UpdateSourceTrigger=PropertyChanged}"
                                                 TextWrapping="Wrap" AcceptsReturn="True" MinHeight="48" />

                                        <TextBlock Grid.Row="5" Grid.Column="0" Text="{DynamicResource Field_DisassemblyInstructionsUser}"
                                                   Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                                   VerticalAlignment="Top" Margin="0,0,12,8" />
                                        <TextBox Grid.Row="5" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                                 Text="{Binding EditDisassemblyInstructionsUser, UpdateSourceTrigger=PropertyChanged}"
                                                 TextWrapping="Wrap" AcceptsReturn="True" MinHeight="48" />

                                        <TextBlock Grid.Row="6" Grid.Column="0" Text="{DynamicResource Field_CircularDesignStrategy}"
                                                   Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                                   VerticalAlignment="Center" Margin="0,0,12,8" />
                                        <TextBox Grid.Row="6" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                                 Text="{Binding EditCircularDesignStrategy, UpdateSourceTrigger=PropertyChanged}" />

                                        <TextBlock Grid.Row="7" Grid.Column="0" Text="{DynamicResource Field_CircularDesignDescription}"
                                                   Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                                   VerticalAlignment="Top" Margin="0,0,12,8" />
                                        <TextBox Grid.Row="7" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                                 Text="{Binding EditCircularDesignDescription, UpdateSourceTrigger=PropertyChanged}"
                                                 TextWrapping="Wrap" AcceptsReturn="True" MinHeight="48" />

                                        <TextBlock Grid.Row="8" Grid.Column="0" Text="{DynamicResource Field_RepairInstructions}"
                                                   Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                                   VerticalAlignment="Top" Margin="0,0,12,8" />
                                        <TextBox Grid.Row="8" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                                 Text="{Binding EditRepairInstructions, UpdateSourceTrigger=PropertyChanged}"
                                                 TextWrapping="Wrap" AcceptsReturn="True" MinHeight="48" />
                                    </Grid>
                                    <Button Content="{DynamicResource Button_SaveCircularity}"
                                            Style="{DynamicResource PrimaryButton}"
                                            Command="{Binding SaveCircularityCommand}"
                                            HorizontalAlignment="Left" Margin="0,8,0,0" />
                                </StackPanel>
                            </Expander>

                            <!-- SECTION 7: Sustainability (only in edit mode) -->
                            <Expander Style="{DynamicResource SectionExpander}"
                                      Visibility="{Binding IsEditMode, Converter={StaticResource BoolToVis}}">
                                <Expander.Header>
                                    <TextBlock Text="{DynamicResource Section_Sustainability}"
                                               Style="{DynamicResource SectionHeader}" />
                                </Expander.Header>
                                <StackPanel Margin="0,8,0,8">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" MinWidth="140" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                        </Grid.RowDefinitions>

                                        <TextBlock Grid.Row="0" Grid.Column="0" Text="{DynamicResource Field_BrandStatement}"
                                                   Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                                   VerticalAlignment="Top" Margin="0,0,12,8" />
                                        <TextBox Grid.Row="0" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                                 Text="{Binding EditBrandStatement, UpdateSourceTrigger=PropertyChanged}"
                                                 TextWrapping="Wrap" AcceptsReturn="True" MinHeight="60" />

                                        <TextBlock Grid.Row="1" Grid.Column="0" Text="{DynamicResource Field_StatementLink}"
                                                   Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                                   VerticalAlignment="Center" Margin="0,0,12,8" />
                                        <TextBox Grid.Row="1" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                                 Text="{Binding EditStatementLink, UpdateSourceTrigger=PropertyChanged}" />

                                        <TextBlock Grid.Row="2" Grid.Column="0" Text="{DynamicResource Field_EnvironmentalFootprint}"
                                                   Style="{DynamicResource FormLabel}" TextAlignment="Right"
                                                   VerticalAlignment="Center" Margin="0,0,12,8" />
                                        <TextBox Grid.Row="2" Grid.Column="1" Style="{DynamicResource FormTextBox}" Margin="0,0,0,8"
                                                 Text="{Binding EditEnvironmentalFootprint, UpdateSourceTrigger=PropertyChanged}" />
                                    </Grid>
                                    <Button Content="{DynamicResource Button_SaveSustainability}"
                                            Style="{DynamicResource PrimaryButton}"
                                            Command="{Binding SaveSustainabilityCommand}"
                                            HorizontalAlignment="Left" Margin="0,8,0,0" />
                                </StackPanel>
                            </Expander>
                        </StackPanel>
                    </ScrollViewer>
                </DockPanel>
            </controls:DrawerPanel.DrawerContent>
        </controls:DrawerPanel>
    </Grid>
</UserControl>
